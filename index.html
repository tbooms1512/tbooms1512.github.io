<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calificando peliculas  üé¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f4f4f5;
      color: #111827;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      background: #f4f4f5;
    }

    header {
      padding: 1.5rem 1.5rem 1rem;
      background: #ffffff;
      border-bottom: 1px solid #e5e7eb;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      max-width: 1000px;
      margin: 0 auto 0.5rem;
    }
    .title {
      font-size: 1.6rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0;
    }
    .logo {
      width: 2.1rem;
      height: 2.1rem;
      border-radius: 0.7rem;
      border: 2px solid #22c55e;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      background: #ecfdf5;
    }
    .subtitle {
      margin: 0;
      font-size: 0.9rem;
      color: #6b7280;
      max-width: 1000px;
      margin: 0 auto;
    }

    .controls {
      max-width: 1000px;
      margin: 0.75rem auto 0;
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }
    .controls input,
    .controls select {
      background: #f9fafb;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 0.5rem 0.9rem;
      color: #111827;
      font-size: 0.9rem;
      outline: none;
    }
    .controls input:focus,
    .controls select:focus {
      border-color: #22c55e;
      box-shadow: 0 0 0 2px #bbf7d029;
    }

    main {
      max-width: 1000px;
      margin: 1.5rem auto 2rem;
      padding: 0 1rem 2rem;
    }

    /* Secci√≥n formulario + nombre */
    .section-card {
      background: #ffffff;
      border-radius: 1rem;
      padding: 1rem;
      border: 1px solid #e5e7eb;
      margin-bottom: 1.25rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.03);
    }
    .section-card h2 {
      font-size: 1rem;
      margin: 0 0 0.4rem;
    }
    .section-card p {
      font-size: 0.85rem;
      margin: 0 0 0.75rem;
      color: #6b7280;
    }
    .name-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
      margin-bottom: 0.75rem;
    }
    .name-row label {
      font-size: 0.8rem;
      color: #6b7280;
    }
    .name-row input {
      padding: 0.4rem 0.6rem;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      color: #111827;
      font-size: 0.9rem;
      outline: none;
      min-width: 180px;
    }
    .name-row input:focus {
      border-color: #22c55e;
      box-shadow: 0 0 0 2px #bbf7d029;
      background: #ffffff;
    }

    #addMovieForm {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: flex-end;
    }
    #addMovieForm label {
      font-size: 0.75rem;
      color: #6b7280;
      display: block;
      margin-bottom: 0.1rem;
    }
    #addMovieForm input {
      width: 100%;
      padding: 0.4rem 0.6rem;
      border-radius: 0.6rem;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      color: #111827;
      font-size: 0.9rem;
      outline: none;
    }
    #addMovieForm input:focus {
      border-color: #22c55e;
      box-shadow: 0 0 0 2px #bbf7d029;
      background: #ffffff;
    }
    .form-field {
      flex: 1 1 180px;
      min-width: 160px;
    }
    .form-field.year {
      width: 110px;
      flex: 0 0 auto;
    }
    .form-button {
      padding: 0.55rem 1.1rem;
      border-radius: 999px;
      border: none;
      background: #22c55e;
      color: #064e3b;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      flex: 0 0 auto;
    }
    .form-button:hover {
      background: #16a34a;
    }
    .form-button.secondary {
      background: #e5e7eb;
      color: #374151;
    }
    .form-button.secondary:hover {
      background: #d4d4d8;
    }

    /* Grid de pel√≠culas */
    .movies-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }
    .movie-card {
      background: #ffffff;
      border-radius: 1rem;
      padding: 0.9rem 0.9rem 0.8rem;
      border: 1px solid #e5e7eb;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.04);
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
    }
    .movie-header {
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      align-items: flex-start;
    }
    .movie-title {
      font-weight: 600;
      font-size: 1rem;
    }
    .movie-year {
      color: #6b7280;
      font-size: 0.85rem;
    }
    .tagline {
      font-size: 0.8rem;
      color: #6b7280;
      margin-top: 0.15rem;
    }
    .badge {
      font-size: 0.7rem;
      border-radius: 999px;
      padding: 0.15rem 0.6rem;
      border: 1px solid #e5e7eb;
      color: #4b5563;
      background: #f9fafb;
      white-space: nowrap;
    }

    .stars {
      display: flex;
      gap: 0.15rem;
      font-size: 1.15rem;
      cursor: pointer;
      user-select: none;
    }
    .stars span {
      transition: transform 0.1s ease-out;
    }
    .stars span:hover {
      transform: translateY(-2px);
    }
    .stars .active {
      color: #facc15;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
    }

    .note-label {
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 0.2rem;
    }
    textarea {
      width: 100%;
      min-height: 70px;
      resize: vertical;
      border-radius: 0.7rem;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      color: #111827;
      padding: 0.5rem 0.6rem;
      font-size: 0.85rem;
      outline: none;
    }
    textarea:focus {
      border-color: #22c55e;
      box-shadow: 0 0 0 2px #bbf7d029;
      background: #ffffff;
    }

    .meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.25rem;
      gap: 0.5rem;
      font-size: 0.75rem;
      color: #6b7280;
      flex-wrap: wrap;
    }
    .date-input {
      background: transparent;
      border: none;
      border-bottom: 1px dashed #d1d5db;
      color: inherit;
      font-size: inherit;
      padding: 0.1rem 0;
      outline: none;
    }
    .pill {
      font-size: 0.75rem;
      background: #f3f4f6;
      border-radius: 999px;
      padding: 0.15rem 0.6rem;
      border: 1px solid #e5e7eb;
      color: #4b5563;
    }

    .actions-row {
      display: flex;
      justify-content: flex-end;
      gap: 0.4rem;
      margin-top: 0.35rem;
    }
    .action-button {
      font-size: 0.75rem;
      padding: 0.25rem 0.7rem;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      color: #4b5563;
      cursor: pointer;
    }
    .action-button:hover {
      background: #e5e7eb;
    }
    .action-button.delete {
      border-color: #fecaca;
      background: #fef2f2;
      color: #b91c1c;
    }
    .action-button.delete:hover {
      background: #fee2e2;
    }

    .empty-state {
      text-align: center;
      margin-top: 2rem;
      color: #9ca3af;
      font-size: 0.9rem;
    }

    footer {
      text-align: center;
      color: #9ca3af;
      font-size: 0.8rem;
      padding: 0 1rem 1.5rem;
    }
  </style>
</head>
<body>
  <header>
    <div class="title-row">
      <h1 class="title">
        <span class="logo">üé¨</span>
        Mi diario de cine
      </h1>
    </div>
    <p class="subtitle">
      Un mini-Letterboxd casero para anotar lo que veo, ponerle estrellas y dejar mis comentarios.
    </p>
    <div class="controls">
      <input
        type="text"
        id="searchInput"
        placeholder="Buscar pel√≠cula..."
      />
      <select id="ratingFilter">
        <option value="0">Todas las calificaciones</option>
        <option value="3">Solo 3‚≠ê o m√°s</option>
        <option value="4">Solo 4‚≠ê o m√°s</option>
        <option value="5">Solo 5‚≠ê</option>
      </select>
    </div>
  </header>

  <main>
    <!-- Nombre del usuario + formulario para agregar / editar pel√≠culas -->
    <section class="section-card">
      <div class="name-row">
        <label for="reviewerName">
          Tu nombre (como quieres que salga en las cr√≠ticas):
        </label>
        <input
          type="text"
          id="reviewerName"
          placeholder="Ej. Tom√°s, T. Boom, etc."
        />
      </div>

      <h2 id="formTitle">Agregar nueva pel√≠cula</h2>
      <p id="formDescription">
        Aqu√≠ puedes ir sumando las pelis que ves. Se guardan solo en este navegador,
        as√≠ que no necesitas cuenta ni nada raro.
      </p>
      <form id="addMovieForm">
        <div class="form-field">
          <label for="newTitle">T√≠tulo</label>
          <input
            type="text"
            id="newTitle"
            required
            placeholder="Ej. Whiplash"
          />
        </div>
        <div class="form-field year">
          <label for="newYear">A√±o</label>
          <input
            type="number"
            id="newYear"
            placeholder="2014"
          />
        </div>
        <div class="form-field">
          <label for="newTags">Etiquetas / g√©neros</label>
          <input
            type="text"
            id="newTags"
            placeholder="Drama, M√∫sica, Intenso"
          />
        </div>
        <button type="submit" id="formButton" class="form-button">
          Agregar
        </button>
        <button
          type="button"
          id="cancelEditButton"
          class="form-button secondary"
          style="display:none;"
        >
          Cancelar
        </button>
      </form>
    </section>

    <!-- Grid de pel√≠culas -->
    <section id="moviesSection">
      <div class="movies-grid" id="moviesGrid"></div>
      <div class="empty-state" id="emptyState" style="display:none;">
        No hay pel√≠culas que coincidan con la b√∫squeda o el filtro.
      </div>
    </section>
  </main>

  <footer>
    
  </footer>

  <script>
    // üîπ Lista base de pel√≠culas (puedes cambiar estas por tus favoritas)
    const baseMovies = [
      {
        id: "pulp-fiction",
        title: "Pulp Fiction",
        year: 1994,
        tags: ["Crimen", "Culto", "Tarantino"]
      },
      {
        id: "the-godfather",
        title: "El Padrino",
        year: 1972,
        tags: ["Mafia", "Cl√°sico"]
      },
      {
        id: "parasite",
        title: "Par√°sitos",
        year: 2019,
        tags: ["Thriller", "Corea del Sur"]
      },
      {
        id: "spiderverse",
        title: "Spider-Man: Into the Spider-Verse",
        year: 2018,
        tags: ["Animaci√≥n", "Superh√©roes"]
      },
      {
        id: "before-sunrise",
        title: "Before Sunrise",
        year: 1995,
        tags: ["Romance", "Conversaci√≥n"]
      }
    ];

    // üîπ Claves para localStorage
    const STATE_KEY   = "mi_diario_cine_estado_v1";      // rating, notas, fecha
    const MOVIES_KEY  = "mi_diario_cine_peliculas_v1";   // lista de pelis
    const NAME_KEY    = "mi_diario_cine_nombre_v1";      // nombre del cr√≠tico

    let state = {};
    let movies = [];
    let reviewerName = "";
    let editingMovieId = null;

    // Cargar / guardar estado (calificaci√≥n, nota, fecha)
    function loadState() {
      try {
        const raw = localStorage.getItem(STATE_KEY);
        state = raw ? JSON.parse(raw) : {};
      } catch (e) {
        console.error("Error leyendo estado de localStorage", e);
        state = {};
      }
    }

    function saveState() {
      localStorage.setItem(STATE_KEY, JSON.stringify(state));
    }

    function getMovieState(id) {
      if (!state[id]) {
        state[id] = {
          rating: 0,
          note: "",
          watchedAt: ""
        };
      }
      return state[id];
    }

    // Cargar / guardar lista de pel√≠culas
    function loadMovies() {
      try {
        const raw = localStorage.getItem(MOVIES_KEY);
        movies = raw ? JSON.parse(raw) : baseMovies;
      } catch (e) {
        console.error("Error leyendo pel√≠culas de localStorage", e);
        movies = baseMovies;
      }
    }

    function saveMovies() {
      localStorage.setItem(MOVIES_KEY, JSON.stringify(movies));
    }

    // Cargar / guardar nombre del cr√≠tico
    function loadReviewerName() {
      try {
        const raw = localStorage.getItem(NAME_KEY);
        reviewerName = raw || "";
      } catch (e) {
        console.error("Error leyendo nombre de localStorage", e);
        reviewerName = "";
      }
    }

    function saveReviewerName() {
      localStorage.setItem(NAME_KEY, reviewerName);
    }

    // Slug para id
    function slugify(text) {
      return text
        .toLowerCase()
        .normalize("NFD")
        .replace(/\p{Diacritic}/gu, "")
        .replace(/[^a-z0-9]+/g, "-")
        .replace(/(^-|-$)/g, "");
    }

    // Referencias al DOM
    const moviesGrid        = document.getElementById("moviesGrid");
    const emptyState        = document.getElementById("emptyState");
    const searchInput       = document.getElementById("searchInput");
    const ratingFilter      = document.getElementById("ratingFilter");
    const addMovieForm      = document.getElementById("addMovieForm");
    const newTitleInput     = document.getElementById("newTitle");
    const newYearInput      = document.getElementById("newYear");
    const newTagsInput      = document.getElementById("newTags");
    const formTitle         = document.getElementById("formTitle");
    const formDescription   = document.getElementById("formDescription");
    const formButton        = document.getElementById("formButton");
    const cancelEditButton  = document.getElementById("cancelEditButton");
    const reviewerNameInput = document.getElementById("reviewerName");

    function setFormToAddMode() {
      editingMovieId = null;
      addMovieForm.reset();
      formTitle.textContent = "Agregar nueva pel√≠cula";
      formDescription.textContent =
        "Aqu√≠ puedes ir sumando las pelis que ves. Se guardan solo en este navegador, as√≠ que no necesitas cuenta ni nada raro.";
      formButton.textContent = "Agregar";
      cancelEditButton.style.display = "none";
    }

    function setFormToEditMode(movie) {
      editingMovieId = movie.id;
      newTitleInput.value = movie.title || "";
      newYearInput.value = movie.year || "";
      newTagsInput.value = movie.tags ? movie.tags.join(", ") : "";
      formTitle.textContent = "Editar pel√≠cula";
      formDescription.textContent =
        "Est√°s editando esta pel√≠cula. Cambia lo que quieras y guarda los cambios o cancela.";
      formButton.textContent = "Guardar cambios";
      cancelEditButton.style.display = "inline-block";
    }

    function renderMovies() {
      const searchTerm = searchInput.value.toLowerCase().trim();
      const minRating = parseInt(ratingFilter.value, 10);

      moviesGrid.innerHTML = "";

      const filtered = movies.filter((movie) => {
        const mState = getMovieState(movie.id);
        const text =
          (movie.title || "") +
          " " +
          (movie.tags ? movie.tags.join(" ") : "");
        const matchesText = text.toLowerCase().includes(searchTerm);
        const matchesRating = mState.rating >= minRating;
        return matchesText && matchesRating;
      });

      if (filtered.length === 0) {
        emptyState.style.display = "block";
        return;
      } else {
        emptyState.style.display = "none";
      }

      filtered.forEach((movie) => {
        const mState = getMovieState(movie.id);

        const card = document.createElement("article");
        card.className = "movie-card";

        const header = document.createElement("div");
        header.className = "movie-header";

        const titleBlock = document.createElement("div");
        const yearText = movie.year ? movie.year : "A√±o N/D";
        const tagsText = movie.tags && movie.tags.length
          ? movie.tags.join(" ‚Ä¢ ")
          : "Sin etiquetas";

        titleBlock.innerHTML = `
          <div class="movie-title">${movie.title}</div>
          <div class="movie-year">${yearText}</div>
          <div class="tagline">${tagsText}</div>
        `;

        const badge = document.createElement("div");
        badge.className = "badge";
        badge.textContent = mState.rating
          ? `${mState.rating}‚≠ê opini√≥n personal`
          : "Sin calificar";

        header.appendChild(titleBlock);
        header.appendChild(badge);

        const starsRow = document.createElement("div");
        starsRow.className = "stars";
        for (let i = 1; i <= 5; i++) {
          const starSpan = document.createElement("span");
          starSpan.textContent = "‚òÖ";
          if (i <= mState.rating) {
            starSpan.classList.add("active");
          }
          starSpan.addEventListener("click", () => {
            setRating(movie.id, i);
          });
          starsRow.appendChild(starSpan);
        }

        const noteLabel = document.createElement("div");
        noteLabel.className = "note-label";
        noteLabel.textContent = reviewerName
          ? `Notas de ${reviewerName}:`
          : "Notas / qu√© me pareci√≥:";

        const textarea = document.createElement("textarea");
        textarea.value = mState.note || "";
        textarea.placeholder = "Ej. La volver√≠a a ver, el final me encant√≥...";
        textarea.addEventListener("input", (e) => {
          const ms = getMovieState(movie.id);
          ms.note = e.target.value;
          saveState();
        });

        const metaRow = document.createElement("div");
        metaRow.className = "meta-row";

        const leftMeta = document.createElement("div");
        leftMeta.innerHTML = `Vista el:
          <input
            type="date"
            class="date-input"
            value="${mState.watchedAt || ""}"
          />
        `;

        const dateInput = leftMeta.querySelector("input");
        dateInput.addEventListener("change", (e) => {
          const ms = getMovieState(movie.id);
          ms.watchedAt = e.target.value;
          saveState();
        });

        const rightMeta = document.createElement("div");
        rightMeta.className = "pill";
        rightMeta.textContent = reviewerName
          ? `Cr√≠tica de: ${reviewerName}`
          : "Cr√≠tica personal";

        metaRow.appendChild(leftMeta);
        metaRow.appendChild(rightMeta);

        // Botones Editar / Borrar
        const actionsRow = document.createElement("div");
        actionsRow.className = "actions-row";

        const editButton = document.createElement("button");
        editButton.type = "button";
        editButton.className = "action-button";
        editButton.textContent = "Editar";
        editButton.addEventListener("click", () => {
          setFormToEditMode(movie);
          window.scrollTo({ top: 0, behavior: "smooth" });
        });

        const deleteButton = document.createElement("button");
        deleteButton.type = "button";
        deleteButton.className = "action-button delete";
        deleteButton.textContent = "Borrar";
        deleteButton.addEventListener("click", () => {
          deleteMovie(movie.id);
        });

        actionsRow.appendChild(editButton);
        actionsRow.appendChild(deleteButton);

        card.appendChild(header);
        card.appendChild(starsRow);
        card.appendChild(noteLabel);
        card.appendChild(textarea);
        card.appendChild(metaRow);
        card.appendChild(actionsRow);

        moviesGrid.appendChild(card);
      });
    }

    function setRating(movieId, rating) {
      const ms = getMovieState(movieId);
      ms.rating = rating;
      saveState();
      renderMovies();
    }

    function deleteMovie(movieId) {
      const movie = movies.find((m) => m.id === movieId);
      const title = movie ? movie.title : "esta pel√≠cula";

      if (!confirm(`¬øSeguro que quieres borrar "${title}" de la lista?`)) {
        return;
      }

      movies = movies.filter((m) => m.id !== movieId);
      delete state[movieId];
      saveMovies();
      saveState();

      if (editingMovieId === movieId) {
        setFormToAddMode();
      }

      renderMovies();
    }

    // Eventos
    searchInput.addEventListener("input", () => renderMovies());
    ratingFilter.addEventListener("change", () => renderMovies());

    addMovieForm.addEventListener("submit", (e) => {
      e.preventDefault();

      const title = newTitleInput.value.trim();
      const year = newYearInput.value ? parseInt(newYearInput.value, 10) : "";
      const tags = newTagsInput.value
        .split(",")
        .map((t) => t.trim())
        .filter(Boolean);

      if (!title) {
        alert("Pon al menos un t√≠tulo üôÇ");
        return;
      }

      if (!editingMovieId) {
        // ‚ûï Modo agregar
        let id = slugify(title);
        if (!id) {
          id = `movie-${Date.now()}`;
        }

        if (movies.some((m) => m.id === id)) {
          alert("Ya tienes una pel√≠cula con ese t√≠tulo.");
          return;
        }

        const newMovie = { id, title, year, tags };
        movies.push(newMovie);
        saveMovies();
        setFormToAddMode();
        renderMovies();
      } else {
        // ‚úèÔ∏è Modo editar
        const idx = movies.findIndex((m) => m.id === editingMovieId);
        if (idx !== -1) {
          movies[idx].title = title;
          movies[idx].year = year;
          movies[idx].tags = tags;
          saveMovies();
        }
        setFormToAddMode();
        renderMovies();
      }
    });

    cancelEditButton.addEventListener("click", () => {
      setFormToAddMode();
    });

    reviewerNameInput.addEventListener("input", (e) => {
      reviewerName = e.target.value.trim();
      saveReviewerName();
      renderMovies();
    });

    // Inicializar
    loadState();
    loadMovies();
    loadReviewerName();
    if (reviewerName) {
      reviewerNameInput.value = reviewerName;
    }
    setFormToAddMode();
    renderMovies();
  </script>
</body>
</html>

